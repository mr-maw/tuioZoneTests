import oscP5.*;
import netP5.*;
import tuioZones.*;

TUIOzoneCollection zones;

PImage img;
float tintValue;
float oldRot;

void setup() {
  size(640,573);
  tintValue = 255;
  
  zones=new TUIOzoneCollection(this);
  zones.setZone("zone1", 0,0,640,573);
  zones.setZone("gesture", 0,0,width,height);
  zones.setZoneParameter("zone1","DRAGGABLE",true);
  //zones.setZoneParameter("zone1","THROWABLE",true);
  zones.setZoneParameter("zone1","SCALABLE",true);
  img = loadImage("butterfly.jpg");
  
  noFill();
  smooth();
  
}

void draw(){

  background(0);
  
  // tint the picture brightness
  tint((int)tintValue);
  
  // use the zone coordinates and size to display the image
  image(img, zones.getZoneX("zone1"),zones.getZoneY("zone1"),zones.getZoneWidth("zone1"),zones.getZoneHeight("zone1"));
  // outline photo when pressed
  if (zones.isZonePressed("gesture")) {
    stroke(200,200,0);
    strokeWeight(4);
    rect(zones.getZoneX("zone1"),zones.getZoneY("zone1"),zones.getZoneWidth("zone1"),zones.getZoneHeight("zone1"));
    
    float rot = zones.getGestureRotation("gesture");
    
    // increase/decrease tint
    if (rot != oldRot) {
      float delta = rot-oldRot;

      /* Ignore huge jumps..
      These happen in 2 cases in particular:
      1) when the second touch point moves straight above the first
      2) when the touch has been released and rotation starts again 
        (as the old rotation was something completely different)
      */
      if (abs(delta) > .5) delta = 0;
      //println(delta);
      
      tintValue += delta*100;
    }
    if (tintValue <= 0) tintValue = 0;
    else if (tintValue > 255) tintValue = 255;
    
    /*
    if(rot < rotMin) rotMin = rot;
    else if(rot > rotMax) rotMax = rot;
    */
    
    
    //println("min: "+rotMin+", max: "+rotMax);
    
    oldRot = rot;
    
    
  
  }
  
}

void touchReleased() {
  
}

